<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DivyaDrishti - Tactical Map</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            background: var(--primary-bg);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
        }
        
        .tactical-header {
            background: rgba(11, 20, 38, 0.95);
            backdrop-filter: blur(20px);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tactical-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .tactical-title h1 {
            font-size: 1.5rem;
            color: var(--accent-teal);
            margin: 0;
        }
        
        .map-container {
            height: calc(100vh - 80px);
            position: relative;
        }
        
        #tacticalMap {
            width: 100%;
            height: 100%;
            background: var(--secondary-bg);
        }
        
        .drone-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 300px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            z-index: 1000;
        }
        
        .drone-status {
            margin-bottom: 1rem;
        }
        
        .drone-status h3 {
            color: var(--accent-teal);
            margin: 0 0 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .status-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .status-label {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .status-value {
            font-size: 0.9rem;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .mission-info {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--glass-border);
        }
        
        .mission-info h4 {
            color: var(--accent-green);
            margin: 0 0 0.5rem 0;
        }
        
        .detection-markers {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 1rem;
            z-index: 1000;
        }
        
        .marker-legend {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .close-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .close-btn:hover {
            background: #ff7043;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <header class="tactical-header">
        <div class="tactical-title">
            <i class="fas fa-map-marked-alt" style="color: var(--accent-teal); font-size: 1.5rem;"></i>
            <h1>Tactical Surveillance Map</h1>
            <span style="color: var(--text-muted); font-size: 0.9rem;">India-Pakistan Border Sector</span>
        </div>
        <button class="close-btn" onclick="window.close()">
            <i class="fas fa-times"></i> Close Map
        </button>
    </header>

    <div class="map-container">
        <div id="tacticalMap"></div>
        
        <!-- Drone Status Panel -->
        <div class="drone-panel">
            <div class="drone-status">
                <h3>
                    <i class="fas fa-helicopter"></i>
                    Alpha Drone Status
                </h3>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">GPS Coordinates</span>
                        <span class="status-value" id="droneGPS">32.79639N, 74.87294E</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Altitude</span>
                        <span class="status-value" id="droneAltitude">150m</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Flight Time</span>
                        <span class="status-value" id="flightTime">03:54:29</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Battery</span>
                        <span class="status-value" id="droneBattery" style="color: var(--accent-green);">78%</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Speed</span>
                        <span class="status-value" id="droneSpeed">25 km/h</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Heading</span>
                        <span class="status-value" id="droneHeading">045°</span>
                    </div>
                </div>
            </div>
            
            <div class="mission-info">
                <h4><i class="fas fa-crosshairs"></i> Mission Details</h4>
                <div class="status-item">
                    <span class="status-label">Operation</span>
                    <span class="status-value">Border Patrol Alpha-7</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Sector</span>
                    <span class="status-value">India-Pakistan Border</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Detection Status</span>
                    <span class="status-value" style="color: var(--accent-green);">Active Monitoring</span>
                </div>
            </div>
        </div>
        
        <!-- Detection Markers Legend -->
        <div class="detection-markers">
            <h4 style="margin: 0 0 1rem 0; color: var(--accent-teal);">
                <i class="fas fa-map-marker-alt"></i> Detection Markers
            </h4>
            <div class="marker-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF5252;"></div>
                    <span>Person Detection</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FFA726;"></div>
                    <span>Unauthorized Trail</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #00E5FF;"></div>
                    <span>Drone Position</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #39FF14;"></div>
                    <span>Safe Zone</span>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize tactical map
        class TacticalMap {
            constructor() {
                this.map = null;
                this.droneMarker = null;
                this.detectionMarkers = [];
                this.dronePosition = [32.79639, 74.87294];
                
                this.init();
            }

            init() {
                this.initializeMap();
                this.addDroneMarker();
                this.addBorderLine();
                this.addDetectionMarkers();
                this.startRealTimeUpdates();
            }

            initializeMap() {
                // Initialize map centered on India-Pakistan border
                this.map = L.map('tacticalMap').setView(this.dronePosition, 15);

                // Add satellite tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors',
                    maxZoom: 18
                }).addTo(this.map);

                // Add dark theme overlay
                this.map.getContainer().style.filter = 'invert(1) hue-rotate(180deg)';
            }

            addDroneMarker() {
                // Create custom drone icon
                const droneIcon = L.divIcon({
                    className: 'drone-marker',
                    html: '<i class="fas fa-helicopter" style="color: #00E5FF; font-size: 20px;"></i>',
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });

                this.droneMarker = L.marker(this.dronePosition, { icon: droneIcon })
                    .addTo(this.map)
                    .bindPopup(`
                        <div style="color: black;">
                            <strong>Alpha Drone</strong><br>
                            Status: Active Patrol<br>
                            Altitude: 150m<br>
                            Battery: 78%
                        </div>
                    `);
            }

            addBorderLine() {
                // Add India-Pakistan border line
                const borderCoords = [
                    [32.79, 74.87],
                    [32.80, 74.88],
                    [32.81, 74.89],
                    [32.82, 74.90]
                ];

                L.polyline(borderCoords, {
                    color: '#FF5252',
                    weight: 3,
                    opacity: 0.8,
                    dashArray: '10, 10'
                }).addTo(this.map).bindPopup('India-Pakistan Border');
            }

            addDetectionMarkers() {
                // Add sample detection markers
                const detections = [
                    {
                        pos: [32.7955, 74.8735],
                        type: 'person',
                        time: '10:45:23',
                        confidence: '89%'
                    },
                    {
                        pos: [32.7970, 74.8720],
                        type: 'trail',
                        time: '10:42:15',
                        confidence: '76%'
                    }
                ];

                detections.forEach(detection => {
                    const color = detection.type === 'person' ? '#FF5252' : '#FFA726';
                    const icon = detection.type === 'person' ? 'fa-user' : 'fa-route';

                    const marker = L.marker(detection.pos, {
                        icon: L.divIcon({
                            className: 'detection-marker',
                            html: `<i class="fas ${icon}" style="color: ${color}; font-size: 16px;"></i>`,
                            iconSize: [20, 20],
                            iconAnchor: [10, 10]
                        })
                    }).addTo(this.map).bindPopup(`
                        <div style="color: black;">
                            <strong>${detection.type.toUpperCase()} DETECTED</strong><br>
                            Time: ${detection.time}<br>
                            Confidence: ${detection.confidence}<br>
                            Status: Under Investigation
                        </div>
                    `);

                    this.detectionMarkers.push(marker);
                });
            }

            startRealTimeUpdates() {
                // Update drone position and status every 5 seconds
                setInterval(() => {
                    this.updateDronePosition();
                    this.updateDroneStatus();
                }, 5000);
            }

            updateDronePosition() {
                // Simulate slight movement
                const lat = this.dronePosition[0] + (Math.random() - 0.5) * 0.001;
                const lng = this.dronePosition[1] + (Math.random() - 0.5) * 0.001;
                
                this.dronePosition = [lat, lng];
                this.droneMarker.setLatLng(this.dronePosition);

                // Update GPS display
                document.getElementById('droneGPS').textContent = 
                    `${lat.toFixed(5)}N, ${lng.toFixed(5)}E`;
            }

            updateDroneStatus() {
                // Update altitude
                const altitude = 150 + Math.floor(Math.random() * 20 - 10);
                document.getElementById('droneAltitude').textContent = `${altitude}m`;

                // Update speed
                const speed = 20 + Math.floor(Math.random() * 10);
                document.getElementById('droneSpeed').textContent = `${speed} km/h`;

                // Update heading
                const heading = Math.floor(Math.random() * 360);
                document.getElementById('droneHeading').textContent = `${heading.toString().padStart(3, '0')}°`;

                // Update flight time
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                document.getElementById('flightTime').textContent = `${hours}:${minutes}:${seconds}`;

                // Update battery (slowly decreasing)
                const currentBattery = parseInt(document.getElementById('droneBattery').textContent);
                if (Math.random() > 0.95 && currentBattery > 20) { // 5% chance to decrease
                    const newBattery = currentBattery - 1;
                    document.getElementById('droneBattery').textContent = `${newBattery}%`;
                    
                    // Change color based on battery level
                    const batteryEl = document.getElementById('droneBattery');
                    if (newBattery < 20) {
                        batteryEl.style.color = '#FF5252';
                    } else if (newBattery < 50) {
                        batteryEl.style.color = '#FFA726';
                    }
                }
            }
        }

        // Initialize tactical map when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new TacticalMap();
        });

        // Add custom marker styles
        const mapStyles = `
            .drone-marker, .detection-marker {
                background: transparent !important;
                border: none !important;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .leaflet-popup-content-wrapper {
                background: rgba(255, 255, 255, 0.95);
                border-radius: 8px;
            }
            
            .leaflet-popup-tip {
                background: rgba(255, 255, 255, 0.95);
            }
        `;

        const mapStyleSheet = document.createElement('style');
        mapStyleSheet.textContent = mapStyles;
        document.head.appendChild(mapStyleSheet);
    </script>
</body>
</html>
